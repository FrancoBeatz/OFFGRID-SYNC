
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFFGRID SYNC | Secure Tactical Vault</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js initialized via CDN -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        :root {
            --dhl-red: #d40511;
            --offgrid-black: #050505;
        }
        body {
            background-color: var(--offgrid-black);
            color: #fff;
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
        }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glitch-bg {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }
        .scanline {
            width: 100%;
            height: 100px;
            z-index: 10;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0) 0%, rgba(212, 5, 17, 0.1) 50%, rgba(0, 0, 0, 0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 6s linear infinite;
        }
        @keyframes scanline {
            0% { bottom: 100%; }
            100% { bottom: -100px; }
        }
        .red-glow { box-shadow: 0 0 25px rgba(212, 5, 17, 0.3); }
        .progress-stripe {
            background-image: linear-gradient(45deg, rgba(255,255,255,.1) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.1) 50%, rgba(255,255,255,.1) 75%, transparent 75%, transparent);
            background-size: 1rem 1rem;
            animation: progress-move 1s linear infinite;
        }
        @keyframes progress-move {
            from { background-position: 1rem 0; }
            to { background-position: 0 0; }
        }
        input:focus { border-color: var(--dhl-red) !important; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body x-data="syncApp" class="glitch-bg min-h-screen">
    <div class="scanline"></div>

    <!-- ISOLATION OVERLAY -->
    <div x-show="isLive" x-cloak x-transition.opacity 
         class="fixed top-0 left-0 right-0 h-10 bg-[#d40511] z-[100] flex items-center justify-center gap-3 shadow-2xl border-b border-white/20">
        <div class="w-2 h-2 rounded-full bg-white animate-pulse"></div>
        <span class="text-[10px] font-black uppercase tracking-[0.4em]">Isolation Protocol Active: Air-Gapped Vault Only</span>
    </div>

    <!-- NAVIGATION -->
    <nav :class="isLive ? 'top-10' : 'top-0'" 
         class="fixed left-0 right-0 h-20 bg-black/90 backdrop-blur-xl border-b border-white/5 z-50 flex items-center justify-between px-6 md:px-12 transition-all duration-500">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-[#d40511] flex items-center justify-center font-black italic shadow-lg text-lg">OS</div>
            <h1 class="text-xl font-black tracking-tighter uppercase italic hidden sm:block">
                OFFGRID <span class="text-[#d40511] not-italic">SYNC</span>
            </h1>
        </div>
        
        <div class="flex items-center gap-6">
            <div class="flex flex-col text-right">
                <span class="text-[9px] font-black uppercase tracking-widest" :class="isOnline ? 'text-emerald-500' : 'text-red-500'" x-text="isOnline ? 'LINK STABLE' : 'LINK SEVERED'"></span>
                <span class="text-[10px] text-zinc-400 mono" x-text="isOnline ? 'H-09 // ACTIVE' : 'S-01 // OFFLINE'"></span>
            </div>
            <div class="w-2 h-8 bg-zinc-800 rounded-full flex flex-col justify-end overflow-hidden">
                <div class="w-full bg-[#d40511] transition-all" :style="`height: ${Math.random()*100}%`"></div>
            </div>
        </div>
    </nav>

    <main class="pt-40 pb-20 px-4 md:px-12 max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-12">
        
        <!-- SIDEBAR: TACTICAL CONTROL -->
        <aside class="lg:col-span-4 space-y-6">
            <div class="bg-zinc-900/60 p-8 border border-white/5 relative overflow-hidden backdrop-blur-md">
                <div class="absolute top-0 right-0 p-2 opacity-10">
                    <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20"><path d="M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V9.236a1 1 0 00-1.447-.894l-4 2a1 1 0 00-.553.894V17zM15.211 6.276a1 1 0 000-1.788l-4.764-2.382a1 1 0 00-.894 0L4.789 4.488a1 1 0 000 1.788l4.764 2.382a1 1 0 00.894 0l4.764-2.382zM4.447 8.342A1 1 0 003 9.236V15a1 1 0 00.553.894l4 2A1 1 0 009 17v-5.764a1 1 0 00-.553-.894l-4-2z"></path></svg>
                </div>
                
                <h3 class="text-[10px] font-black text-[#d40511] uppercase tracking-[0.3em] mb-8">Storage Dynamics</h3>
                
                <div class="space-y-8">
                    <!-- Gauge -->
                    <div class="bg-black/40 p-5 border border-white/5">
                        <div class="flex justify-between items-end mb-3">
                            <div>
                                <p class="text-[8px] text-zinc-500 font-black uppercase tracking-widest">Memory Cluster</p>
                                <p class="text-2xl font-black mono" x-text="`${(totalMB/1024).toFixed(2)} GB`"></p>
                            </div>
                            <span class="text-[10px] font-bold text-zinc-600 mono" x-text="`${Math.min(100, (totalMB/10240)*100).toFixed(1)}%` "></span>
                        </div>
                        <div class="w-full h-1.5 bg-zinc-800 overflow-hidden relative">
                            <div class="h-full bg-[#d40511] transition-all duration-700 progress-stripe red-glow" 
                                 :style="`width: ${Math.min(100, (totalMB/10240)*100)}%`"></div>
                        </div>
                        <p class="text-[8px] text-zinc-600 mt-2 font-bold uppercase tracking-widest">10,240 MB Capacity Threshold</p>
                    </div>

                    <!-- Actions -->
                    <div class="flex flex-col gap-3">
                        <button x-show="!isSyncing" x-cloak
                                @click="startSync" 
                                :disabled="!isOnline || totalMB >= 10240"
                                class="group relative bg-[#d40511] py-4 px-6 text-xs font-black uppercase tracking-[0.2em] flex items-center justify-center gap-3 hover:bg-red-700 transition-all disabled:opacity-20 disabled:grayscale">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                            Initialize Sync
                            <div class="absolute -bottom-1 -right-1 w-2 h-2 bg-white"></div>
                        </button>

                        <button x-show="isSyncing" x-cloak
                                @click="stopSync"
                                class="bg-zinc-800 py-4 px-6 text-xs font-black uppercase tracking-[0.2em] flex items-center justify-center gap-3 border border-red-500/30 animate-pulse">
                            Abort Stream
                        </button>

                        <div class="grid grid-cols-2 gap-3">
                            <button @click="goLive(true)" 
                                    :class="isLive ? 'bg-emerald-600 border-emerald-500 text-white' : 'bg-transparent border-white/10 text-zinc-500'"
                                    class="py-4 text-[10px] font-black uppercase tracking-widest border transition-all hover:border-white/40">
                                Go Live
                            </button>
                            <button @click="goLive(false)"
                                    :class="!isLive ? 'bg-white text-black' : 'bg-transparent border-white/10 text-zinc-500'"
                                    class="py-4 text-[10px] font-black uppercase tracking-widest border transition-all hover:border-white/40">
                                Standby
                            </button>
                        </div>

                        <button @click="wipeVault" 
                                class="mt-4 text-[9px] font-black text-zinc-600 hover:text-red-500 uppercase tracking-[0.3em] transition-colors">
                            Wipe Local Cache
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-6 bg-zinc-900/20 border border-white/5 text-[9px] font-black text-zinc-500 uppercase tracking-[0.4em] leading-loose">
                <p>Hardware: X-Node Prime</p>
                <p>Cipher: AES-X GCM 256</p>
                <p>Status: <span :class="isLive ? 'text-emerald-500' : 'text-zinc-600'" x-text="isLive ? 'ISOLATED' : 'NETWORK_ACTIVE'"></span></p>
            </div>
        </aside>

        <!-- MAIN FEED: TACTICAL ASSETS -->
        <section class="lg:col-span-8 space-y-8">
            <div class="flex flex-wrap items-center gap-4 bg-zinc-900/40 p-4 border border-white/5 backdrop-blur-sm">
                <div class="flex-1 min-w-[240px] relative">
                    <input type="text" 
                           x-model="search"
                           placeholder="Filter Cluster..."
                           class="w-full bg-black border border-white/10 px-10 py-4 text-[11px] font-black uppercase tracking-[0.2em] focus:outline-none transition-all placeholder:text-zinc-800">
                    <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                </div>
                
                <select x-model="category"
                        class="bg-black border border-white/10 px-6 py-4 text-[10px] font-black uppercase tracking-widest outline-none cursor-pointer hover:border-white/30 transition-all">
                    <option value="ALL">All Categories</option>
                    <option value="NETWORK">Network Packs</option>
                    <option value="SYSTEM">Core Assets</option>
                    <option value="INTEL">Tactical Intel</option>
                    <option value="AUTH">Secure Keys</option>
                </select>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <template x-for="item in filteredItems" :key="item.id">
                    <div class="group relative p-8 bg-zinc-900/40 border border-white/5 hover:border-red-500/40 transition-all duration-500 hover:scale-[1.02] overflow-hidden">
                        <!-- Progress Strip -->
                        <div x-show="item.status === 'SYNCING'" 
                             class="absolute top-0 left-0 h-1 bg-zinc-800 w-full overflow-hidden">
                            <div class="h-full bg-[#d40511] progress-stripe" :style="`width: ${item.progress}%` transition:width 0.3s ease-out"></div>
                        </div>

                        <div class="flex justify-between items-start mb-6">
                            <span class="text-[9px] font-black uppercase tracking-[0.3em] text-zinc-600" x-text="item.category"></span>
                            <div class="flex items-center gap-2">
                                <span class="text-[9px] font-black uppercase tracking-widest"
                                      :class="{
                                        'text-emerald-500': item.status === 'SYNCED',
                                        'text-red-500 animate-pulse': item.status === 'SYNCING',
                                        'text-zinc-700': item.status === 'REMOTE'
                                      }"
                                      x-text="item.status === 'SYNCED' ? 'Secured' : (item.status === 'SYNCING' ? 'Syncing' : 'Remote')">
                                </span>
                                <div class="w-1.5 h-1.5 rounded-full" 
                                     :class="item.status === 'SYNCED' ? 'bg-emerald-500 shadow-[0_0_8px_#10b981]' : (item.status === 'SYNCING' ? 'bg-red-500' : 'bg-zinc-800')"></div>
                            </div>
                        </div>

                        <h4 class="text-xl font-black mb-3 tracking-tight group-hover:text-red-500 transition-colors" x-text="item.title"></h4>
                        <p class="text-zinc-500 text-xs leading-relaxed mb-8 mono" x-text="item.description"></p>

                        <div class="flex items-center justify-between pt-6 border-t border-white/5">
                            <div class="flex flex-col gap-1">
                                <span class="text-[9px] font-bold text-zinc-700 mono" x-text="`UID: ${item.id}`"></span>
                                <span class="text-[9px] font-bold text-zinc-700 mono" x-text="`LAT: ${item.timestamp}`"></span>
                            </div>
                            <button class="p-2 border border-white/5 text-zinc-700 hover:text-white hover:bg-zinc-800 transition-all opacity-0 group-hover:opacity-100">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('syncApp', () => ({
                isOnline: navigator.onLine,
                isLive: false,
                isSyncing: false,
                search: '',
                category: 'ALL',
                totalMB: 0,
                db: null,
                items: [
                    { id: 'OS-001', title: 'Network Node Config', description: 'Deep-cache routing protocols for satellite bridge bypass.', category: 'NETWORK', timestamp: '11:04:22', size: 1250, status: 'REMOTE', progress: 0 },
                    { id: 'OS-002', title: 'System Kernel Patch', description: 'Core OS binaries for air-gapped terminal maintenance.', category: 'SYSTEM', timestamp: '09:12:45', size: 1250, status: 'REMOTE', progress: 0 },
                    { id: 'OS-003', title: 'Regional Mapping Delta', description: 'High-res topography for offline tactical navigation.', category: 'INTEL', timestamp: '04:55:10', size: 1250, status: 'REMOTE', progress: 0 },
                    { id: 'OS-004', title: 'Biometric Auth Salt', description: 'Encrypted hash tables for multi-factor local verification.', category: 'AUTH', timestamp: '23:40:01', size: 1250, status: 'REMOTE', progress: 0 },
                    { id: 'OS-005', title: 'Field Medic Protocol', description: 'Emergency medical database with offline visualization.', category: 'INTEL', timestamp: '15:20:11', size: 1250, status: 'REMOTE', progress: 0 }
                ],
                abortController: null,

                async init() {
                    window.addEventListener('online', () => this.isOnline = true);
                    window.addEventListener('offline', () => this.isOnline = false);
                    
                    try {
                        await this.initDB();
                        await this.loadFromStorage();
                    } catch (e) {
                        console.error("Vault initialization failed:", e);
                    }
                },

                initDB() {
                    return new Promise((resolve, reject) => {
                        const request = indexedDB.open('OffgridSyncVault', 1);
                        request.onupgradeneeded = (e) => {
                            const db = e.target.result;
                            if (!db.objectStoreNames.contains('assets')) {
                                db.createObjectStore('assets', { keyPath: 'id' });
                            }
                        };
                        request.onsuccess = (e) => {
                            this.db = e.target.result;
                            resolve();
                        };
                        request.onerror = (e) => reject(e);
                    });
                },

                async loadFromStorage() {
                    if (!this.db) return;
                    const tx = this.db.transaction('assets', 'readonly');
                    const store = tx.objectStore('assets');
                    const request = store.getAll();
                    
                    request.onsuccess = () => {
                        const storedItems = request.result;
                        this.totalMB = 0;
                        this.items = this.items.map(item => {
                            const found = storedItems.find(s => s.id === item.id);
                            if (found) {
                                this.totalMB += found.size;
                                return { ...item, ...found };
                            }
                            return item;
                        });
                    };
                },

                async startSync() {
                    if (this.isSyncing || !this.isOnline) return;
                    this.isSyncing = true;
                    this.abortController = false;

                    const queue = this.items.filter(i => i.status === 'REMOTE');

                    for (const item of queue) {
                        if (this.abortController) break;
                        if (this.totalMB + item.size > 10240) {
                            alert('VAULT CAPACITY EXCEEDED (10GB LIMIT). WIPE CACHE TO CONTINUE.');
                            break;
                        }

                        // Update Status
                        item.status = 'SYNCING';
                        item.progress = 0;

                        // Simulate Stream
                        for (let p = 0; p <= 100; p += 5) {
                            if (this.abortController) break;
                            await new Promise(r => setTimeout(r, 100));
                            item.progress = p;
                        }

                        if (!this.abortController) {
                            item.status = 'SYNCED';
                            item.progress = 100;
                            this.totalMB += item.size;
                            await this.saveToDB(item);
                        } else {
                            item.status = 'REMOTE';
                            item.progress = 0;
                        }
                    }
                    this.isSyncing = false;
                },

                stopSync() {
                    this.abortController = true;
                    this.isSyncing = false;
                    this.items.forEach(i => {
                        if (i.status === 'SYNCING') {
                            i.status = 'REMOTE';
                            i.progress = 0;
                        }
                    });
                },

                goLive(active) {
                    this.isLive = active;
                },

                async saveToDB(item) {
                    if (!this.db) return;
                    const tx = this.db.transaction('assets', 'readwrite');
                    tx.objectStore('assets').put(JSON.parse(JSON.stringify(item)));
                },

                async wipeVault() {
                    if (!this.db) return;
                    if (confirm('AUTHORIZATION REQUIRED: WIPE LOCAL DATA?')) {
                        const tx = this.db.transaction('assets', 'readwrite');
                        tx.objectStore('assets').clear();
                        this.totalMB = 0;
                        this.items.forEach(i => {
                            i.status = 'REMOTE';
                            i.progress = 0;
                        });
                        this.isLive = false;
                    }
                },

                get filteredItems() {
                    let pool = this.items;
                    if (this.isLive) {
                        pool = pool.filter(i => i.status === 'SYNCED');
                    }
                    if (this.category !== 'ALL') {
                        pool = pool.filter(i => i.category === this.category);
                    }
                    if (this.search) {
                        const s = this.search.toLowerCase();
                        pool = pool.filter(i => i.title.toLowerCase().includes(s) || i.description.toLowerCase().includes(s));
                    }
                    return pool;
                }
            }));
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(e => {});
            });
        }
    </script>
</body>
</html>
